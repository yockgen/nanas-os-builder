image:
  name: emt3-default-x86_64
  version: "1.0.0"

target:
  os: edge-microvisor-toolkit # Target OS name
  dist: emt3 # Target OS distribution
  arch: x86_64 # Target OS architecture
  imageType: raw # Image type, valid value: [raw, iso].

disk:
  name: Default_Raw # 1:1 mapping to the systemConfigs name
  artifacts:
    -
      type: raw  # image file format
      compression: gz # image compression format (optional)
  size: 4GiB # 4G, 4GB, 4096 MiB also valid. (Required for raw)
  partitionTableType: gpt # Partition table type, valid value: [gpt, mbr]
  partitions: # Required for raw, optional for ISO, not needed for rootfs.
    - id: boot
      type: esp
      flags:
        - esp
        - boot
      start: 1MiB
      end: 513MiB
      fsType: fat32
      mountPoint: /boot/efi
      mountOptions: umask=0077

    - id: rootfs
      type: linux-root-amd64
      start: 513MiB
      end: 2561MiB
      fsType: ext4
      mountPoint: /
      mountOptions: defaults,ro

    - id: roothashmap
      type: linux
      start: 2561MiB
      end: 3061MiB
      fsType: ext4
      mountPoint: none

    - id: userdata
      type: linux
      start: 3061MiB
      end: "0"  # use the rest of the disk space
      fsType: ext4
      mountPoint: /opt

systemConfig:
  name: Default_Raw
  description: Default yml configuration for raw image

  bootloader:
    bootType: efi # (efi or legacy)
    provider: systemd-boot # (grub for efi and legacy mode, or systemd-boot for efi mode)

  immutability:
    enabled: false # default is false

  packages:
    # base packages
    - systemd-boot
    - systemd-ukify
    - ca-certificates
    - cronie-anacron
    - logrotate
    - core-packages-base-image
    - initramfs
    - shadow-utils

    # ssh server
    - openssh-server

    # virtualization host
    - qemu-kvm

    # agent packages
    - hardware-discovery-agent
    - cluster-agent
    - node-agent
    - platform-observability-agent
    - platform-telemetry-agent
    - platform-update-agent
    - inbm
    - reporting-agent

    # tinker tools
    - gptfdisk
    - cloud-init
    - cloud-utils-growpart
    - tpm2-tools
    - lvm2
    - netplan
    - efibootmgr
    - unzip
    - rsyslog
    - tpm2-initramfs-tool
    - veritysetup
    - python3-pyserial

    # persistent mount
    - rsync

    # selinux full
    - selinux-policy
    - selinux-policy-devel
    - policycoreutils-python-utils
    - checkpolicy
    - secilc
    - setools-console

    # intel gpu base
    - kernel-drivers-gpu
    - linux-firmware-i915
    - linux-firmware-ice
    - intel-npu-firmware

    # intel wireless
    - linux-firmware-iwlwifi
    - wireless-regdb

    # os ab update
    - os-ab-update

    # vpro amt
    - rpc
    - intel-lms

    # docker
    - moby-engine
    - docker-cli
    - docker-compose

  additionalFiles:
    - local: 99-dhcp-en.network
      final: /etc/systemd/network/99-dhcp-en.network
    - local: systemd-networkd-wait-online-override.conf
      final: /etc/systemd/system/systemd-networkd-wait-online.service.d/override.conf
    - local: emt-cloud-init.cfg
      final: /etc/cloud/cloud.cfg

  kernel:
    name: kernel
    version: "6.12"
    cmdline: "console=ttyS0,115200 console=tty0 loglevel=7"
    uki: true