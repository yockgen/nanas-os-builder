{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://https://raw.githubusercontent.com/intel-innersource/os.linux.tiberos.os-curation-tool/refs/heads/main/schemas/os-image-composer.schema.json",
    "title": "OS Image Composer Input",
    "description": "Defines packages, OS platform/version, output formats, and kernel configuration for the image composer",
    "type": "object",
  
    "properties": {
      "distro": {
        "type": "string",
        "description": "Which OS platform to build against",
        "enum": ["EMT", "AzureLinux", "eLxr"]
      },
      "version": {
        "type": "string",
        "description": "Version of the selected OS platform",
        "pattern": "^[0-9]+(\\.[0-9]+)*$"
      },
      "arch": {
        "type": "string",
        "description": "Architecture of the OS image",
        "enum": ["x86_64", "aarch64"]
      },
      "packages": {
        "type": "array",
        "description": "List of packages to include",
        "items": { "type": "string" },
        "minItems": 1
      },
      "immutable": {
        "type": "boolean",
        "description": "Flags indicating whether each package is immutable"
      },
      "output": {
        "type": "string",
        "description": "Desired output artifact types",
        "items": {
          "type": "string",
          "enum": ["iso", "img", "vhd"]
        },
        "minItems": 1
      },
      "kernel": {
        "type": "object",
        "description": "Kernel version and optional command-line",
        "properties": {
          "version": {
            "type": "string",
            "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$",
            "description": "Kernel version to include"
          },
          "cmdline": {
            "type": "string",
            "description": "Additional kernel command-line parameters"
          }
        },
        "required": ["version"],
        "additionalProperties": false
      }
    },
  
    "required": ["distro", "version", "arch", "packages", "immutable", "output", "kernel"],
    "additionalProperties": false,
  
    "allOf": [
        {
          "if":   { "properties": { "distro": { "const": "EMT" } } },
          "then": { "properties": { "version": { "enum": ["3.0", "3.1"] } } }
        },
        {
          "if":   { "properties": { "distro": { "const": "AzureLinux" } } },
          "then": { "properties": { "version": { "enum": ["3"] } } }
        },
        {
          "if":   { "properties": { "distro": { "const": "eLxr" } } },
          "then": { "properties": { "version": { "enum": ["12"] } } }
        }
      ]
    }
    